services:
  # ---------- Config Server ----------
  mongo-cfg1:
    image: bitnami/mongodb:latest
    environment:
      - MONGODB_ADVERTISED_HOSTNAME=mongo-cfg1
      - MONGODB_SHARDING_MODE=configsvr
      - MONGODB_REPLICA_SET_NAME=configReplSet
      - MONGODB_PORT_NUMBER=27019
      - MONGODB_ROOT_USER=${ROOT_USER}
      - MONGODB_ROOT_PASSWORD=${ROOT_PASSWORD}
      - MONGODB_REPLICA_SET_KEY=${REPLICA_SET_KEY}
      - ALLOW_EMPTY_PASSWORD=no
    volumes:
      - ./mongo-cfg1-data:/bitnami/mongodb
    networks:
      - mongodb-network

  mongo-cfg2:
    image: bitnami/mongodb:latest
    environment:
      - MONGODB_ADVERTISED_HOSTNAME=mongo-cfg2
      - MONGODB_SHARDING_MODE=configsvr
      - MONGODB_REPLICA_SET_NAME=configReplSet
      - MONGODB_INITIAL_PRIMARY_HOST=mongo-cfg1
      - MONGODB_PORT_NUMBER=27019
      - MONGODB_ROOT_USER=${ROOT_USER}
      - MONGODB_ROOT_PASSWORD=${ROOT_PASSWORD}
      - MONGODB_REPLICA_SET_KEY=${REPLICA_SET_KEY}
      - ALLOW_EMPTY_PASSWORD=no
    volumes:
      - ./mongo-cfg2-data:/bitnami/mongodb
    networks:
      - mongodb-network
    depends_on:
      - mongo-cfg1

  mongo-cfg3:
    image: bitnami/mongodb:latest
    environment:
      - MONGODB_ADVERTISED_HOSTNAME=mongo-cfg3
      - MONGODB_SHARDING_MODE=configsvr
      - MONGODB_REPLICA_SET_NAME=configReplSet
      - MONGODB_INITIAL_PRIMARY_HOST=mongo-cfg1
      - MONGODB_PORT_NUMBER=27019
      - MONGODB_ROOT_USER=${ROOT_USER}
      - MONGODB_ROOT_PASSWORD=${ROOT_PASSWORD}
      - MONGODB_REPLICA_SET_KEY=${REPLICA_SET_KEY}
      - ALLOW_EMPTY_PASSWORD=no
    volumes:
      - ./mongo-cfg3-data:/bitnami/mongodb
    networks:
      - mongodb-network
    depends_on:
      - mongo-cfg1

  # ---------- Shard 1 ----------
  mongo-shard1a:
    image: bitnami/mongodb:latest
    environment:
      - MONGODB_ADVERTISED_HOSTNAME=mongo-shard1a
      - MONGODB_SHARDING_MODE=shardsvr
      - MONGODB_REPLICA_SET_NAME=shard1ReplSet
      - MONGODB_CONFIG_SVR_REPLICA_SET_NAME=configReplSet
      - MONGODB_CONFIG_SVR_HOSTS=mongo-cfg1:27019,mongo-cfg2:27019,mongo-cfg3:27019
      - MONGODB_PORT_NUMBER=27018
      - MONGODB_ROOT_USER=${ROOT_USER}
      - MONGODB_ROOT_PASSWORD=${ROOT_PASSWORD}
      - MONGODB_REPLICA_SET_KEY=${REPLICA_SET_KEY}
      - ALLOW_EMPTY_PASSWORD=no
    volumes:
      - ./mongo-shard1a-data:/bitnami/mongodb
    networks:
      - mongodb-network

  mongo-shard1b:
    image: bitnami/mongodb:latest
    environment:
      - MONGODB_ADVERTISED_HOSTNAME=mongo-shard1b
      - MONGODB_SHARDING_MODE=shardsvr
      - MONGODB_REPLICA_SET_NAME=shard1ReplSet
      - MONGODB_INITIAL_PRIMARY_HOST=mongo-shard1a
      - MONGODB_CONFIG_SVR_REPLICA_SET_NAME=configReplSet
      - MONGODB_CONFIG_SVR_HOSTS=mongo-cfg1:27019,mongo-cfg2:27019,mongo-cfg3:27019
      - MONGODB_PORT_NUMBER=27018
      - MONGODB_ROOT_USER=${ROOT_USER}
      - MONGODB_ROOT_PASSWORD=${ROOT_PASSWORD}
      - MONGODB_REPLICA_SET_KEY=${REPLICA_SET_KEY}
      - ALLOW_EMPTY_PASSWORD=no
    volumes:
      - ./mongo-shard1b-data:/bitnami/mongodb
    networks:
      - mongodb-network
    depends_on:
      - mongo-shard1a

  mongo-shard1c:
    image: bitnami/mongodb:latest
    environment:
      - MONGODB_ADVERTISED_HOSTNAME=mongo-shard1c
      - MONGODB_SHARDING_MODE=shardsvr
      - MONGODB_REPLICA_SET_NAME=shard1ReplSet
      - MONGODB_INITIAL_PRIMARY_HOST=mongo-shard1a
      - MONGODB_CONFIG_SVR_REPLICA_SET_NAME=configReplSet
      - MONGODB_CONFIG_SVR_HOSTS=mongo-cfg1:27019,mongo-cfg2:27019,mongo-cfg3:27019
      - MONGODB_PORT_NUMBER=27018
      - MONGODB_ROOT_USER=${ROOT_USER}
      - MONGODB_ROOT_PASSWORD=${ROOT_PASSWORD}
      - MONGODB_REPLICA_SET_KEY=${REPLICA_SET_KEY}
      - ALLOW_EMPTY_PASSWORD=no
    volumes:
      - ./mongo-shard1c-data:/bitnami/mongodb
    networks:
      - mongodb-network
    depends_on:
      - mongo-shard1a

  # ---------- Shard 2 ----------
  mongo-shard2a:
    image: bitnami/mongodb:latest
    environment:
      - MONGODB_ADVERTISED_HOSTNAME=mongo-shard2a
      - MONGODB_SHARDING_MODE=shardsvr
      - MONGODB_REPLICA_SET_NAME=shard2ReplSet
      - MONGODB_CONFIG_SVR_REPLICA_SET_NAME=configReplSet
      - MONGODB_CONFIG_SVR_HOSTS=mongo-cfg1:27019,mongo-cfg2:27019,mongo-cfg3:27019
      - MONGODB_PORT_NUMBER=27018
      - MONGODB_ROOT_USER=${ROOT_USER}
      - MONGODB_ROOT_PASSWORD=${ROOT_PASSWORD}
      - MONGODB_REPLICA_SET_KEY=${REPLICA_SET_KEY}
      - ALLOW_EMPTY_PASSWORD=no
    volumes:
      - ./mongo-shard2a-data:/bitnami/mongodb
    networks:
      - mongodb-network

  mongo-shard2b:
    image: bitnami/mongodb:latest
    environment:
      - MONGODB_ADVERTISED_HOSTNAME=mongo-shard2b
      - MONGODB_SHARDING_MODE=shardsvr
      - MONGODB_REPLICA_SET_NAME=shard2ReplSet
      - MONGODB_INITIAL_PRIMARY_HOST=mongo-shard2a
      - MONGODB_CONFIG_SVR_REPLICA_SET_NAME=configReplSet
      - MONGODB_CONFIG_SVR_HOSTS=mongo-cfg1:27019,mongo-cfg2:27019,mongo-cfg3:27019
      - MONGODB_PORT_NUMBER=27018
      - MONGODB_ROOT_USER=${ROOT_USER}
      - MONGODB_ROOT_PASSWORD=${ROOT_PASSWORD}
      - MONGODB_REPLICA_SET_KEY=${REPLICA_SET_KEY}
      - ALLOW_EMPTY_PASSWORD=no
    volumes:
      - ./mongo-shard2b-data:/bitnami/mongodb
    networks:
      - mongodb-network
    depends_on:
      - mongo-shard2a

  mongo-shard2c:
    image: bitnami/mongodb:latest
    environment:
      - MONGODB_ADVERTISED_HOSTNAME=mongo-shard2c
      - MONGODB_SHARDING_MODE=shardsvr
      - MONGODB_REPLICA_SET_NAME=shard2ReplSet
      - MONGODB_INITIAL_PRIMARY_HOST=mongo-shard2a
      - MONGODB_CONFIG_SVR_REPLICA_SET_NAME=configReplSet
      - MONGODB_CONFIG_SVR_HOSTS=mongo-cfg1:27019,mongo-cfg2:27019,mongo-cfg3:27019
      - MONGODB_PORT_NUMBER=27018
      - MONGODB_ROOT_USER=${ROOT_USER}
      - MONGODB_ROOT_PASSWORD=${ROOT_PASSWORD}
      - MONGODB_REPLICA_SET_KEY=${REPLICA_SET_KEY}
      - ALLOW_EMPTY_PASSWORD=no
    volumes:
      - ./mongo-shard2c-data:/bitnami/mongodb
    networks:
      - mongodb-network
    depends_on:
      - mongo-shard2a

  # ---------- Shard 3 ----------
  mongo-shard3a:
    image: bitnami/mongodb:latest
    environment:
      - MONGODB_ADVERTISED_HOSTNAME=mongo-shard3a
      - MONGODB_SHARDING_MODE=shardsvr
      - MONGODB_REPLICA_SET_NAME=shard3ReplSet
      - MONGODB_CONFIG_SVR_REPLICA_SET_NAME=configReplSet
      - MONGODB_CONFIG_SVR_HOSTS=mongo-cfg1:27019,mongo-cfg2:27019,mongo-cfg3:27019
      - MONGODB_PORT_NUMBER=27018
      - MONGODB_ROOT_USER=${ROOT_USER}
      - MONGODB_ROOT_PASSWORD=${ROOT_PASSWORD}
      - MONGODB_REPLICA_SET_KEY=${REPLICA_SET_KEY}
      - ALLOW_EMPTY_PASSWORD=no
    volumes:
      - ./mongo-shard3a-data:/bitnami/mongodb
    networks:
      - mongodb-network

  mongo-shard3b:
    image: bitnami/mongodb:latest
    environment:
      - MONGODB_ADVERTISED_HOSTNAME=mongo-shard3b
      - MONGODB_SHARDING_MODE=shardsvr
      - MONGODB_REPLICA_SET_NAME=shard3ReplSet
      - MONGODB_INITIAL_PRIMARY_HOST=mongo-shard3a
      - MONGODB_CONFIG_SVR_REPLICA_SET_NAME=configReplSet
      - MONGODB_CONFIG_SVR_HOSTS=mongo-cfg1:27019,mongo-cfg2:27019,mongo-cfg3:27019
      - MONGODB_PORT_NUMBER=27018
      - MONGODB_ROOT_USER=${ROOT_USER}
      - MONGODB_ROOT_PASSWORD=${ROOT_PASSWORD}
      - MONGODB_REPLICA_SET_KEY=${REPLICA_SET_KEY}
      - ALLOW_EMPTY_PASSWORD=no
    volumes:
      - ./mongo-shard3b-data:/bitnami/mongodb
    networks:
      - mongodb-network
    depends_on:
      - mongo-shard3a

  mongo-shard3c:
    image: bitnami/mongodb:latest
    environment:
      - MONGODB_ADVERTISED_HOSTNAME=mongo-shard3c
      - MONGODB_SHARDING_MODE=shardsvr
      - MONGODB_REPLICA_SET_NAME=shard3ReplSet
      - MONGODB_INITIAL_PRIMARY_HOST=mongo-shard3a
      - MONGODB_CONFIG_SVR_REPLICA_SET_NAME=configReplSet
      - MONGODB_CONFIG_SVR_HOSTS=mongo-cfg1:27019,mongo-cfg2:27019,mongo-cfg3:27019
      - MONGODB_PORT_NUMBER=27018
      - MONGODB_ROOT_USER=${ROOT_USER}
      - MONGODB_ROOT_PASSWORD=${ROOT_PASSWORD}
      - MONGODB_REPLICA_SET_KEY=${REPLICA_SET_KEY}
      - ALLOW_EMPTY_PASSWORD=no
    volumes:
      - ./mongo-shard3c-data:/bitnami/mongodb
    networks:
      - mongodb-network
    depends_on:
      - mongo-shard3a

  # ---------- Mongos Router ----------
  mongos:
    image: bitnami/mongodb:latest
    ports:
      - "27017:27017"
    depends_on:
      - mongo-cfg1
      - mongo-cfg2
      - mongo-cfg3
      - mongo-shard1a
      - mongo-shard1b
      - mongo-shard1c
      - mongo-shard2a
      - mongo-shard2b
      - mongo-shard2c
      - mongo-shard3a
      - mongo-shard3b
      - mongo-shard3c
    environment:
      - MONGODB_ADVERTISED_HOSTNAME=mongos
      - MONGODB_SHARDING_MODE=mongos
      - MONGODB_CFG_REPLICA_SET_NAME=configReplSet
      - MONGODB_CFG_PRIMARY_HOST=mongo-cfg1
      - MONGODB_CFG_PRIMARY_PORT_NUMBER=27019
      - MONGODB_REPLICA_SET_KEY=${REPLICA_SET_KEY}
      - MONGODB_ROOT_USER=${ROOT_USER}
      - MONGODB_ROOT_PASSWORD=${ROOT_PASSWORD}
    networks:
      - mongodb-network

networks:
  mongodb-network:
    driver: bridge
