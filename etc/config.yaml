profile:
  env: dev

hermet:
  web:
    addr: ":8080"
    read_header_timeout: 5s # 读取请求头超时，防止 Slowloris 攻击
    read_timeout: 15s       # 读取整个请求超时，IM 请求通常较小
    write_timeout: 90s      # 写响应超时，历史记录数据量可能较大
    idle_timeout: 120s      # Keep-Alive 空闲超时，IM 客户端会频繁请求

  session:
    expiration: 12h

  cors:
    max_age: 86400s
    hostnames:
      - "localhost"
      - "172.19.208.1" # wsl ip

  ignores:
    - "/api/v1/user/sign-in"
    - "/api/v1/user/refresh-token"

# Redis 配置
redis:
  addr: 192.168.3.3:6379
  password: "<passwd>"

# 数据库配置
db:
  log_level: "info"
  slow_threshold: 200ms # 慢查询阈值
  ignore_record_not_found_error: true
  # sslmode=disable 用于开发环境，线上一般推荐使用 sslmode=require / sslmode=verify-ca(更高安全性) / sslmode=verify-full (最高安全性)
  dsn: "postgres://jrmarcco:%3Cpasswd%3E@192.168.3.3:5432/hermet?sslmode=disable&connect_timeout=1&statement_timeout=3000&idle_in_transaction_session_timeout=3000"

# MongoDB 配置
mongo:
  uri: "mongodb://192.168.3.3:27017"
  db_name: "hermet"
  app_name: "hermet"
  # 认证信息
  username: "root"
  password: "root123"
  auth_source: "admin"
  # 连接池配置
  max_pool_size: 100
  max_conn_idle_time: 10s
  connect_timeout: 1s
  server_selection_timeout: 1s
  startup_timeout: 1s
  shutdown_timeout: 1s
  # 分片配置
  sharding:
    - collection_name: "message"
      key: "cid"
      type: "hashed"

# Kafka 配置
kafka:
  # Kafka Broker
  brokers:
    - "192.168.3.3:19092"
    - "192.168.3.3:29092"
    - "192.168.3.3:39092"

  # Producer 配置
  producer:
    required_acks: -1            # all
    compression: "snappy"        # 使用 snappy 压缩
    max_message_bytes: 1024000   # 最大消息大小 1024000字节 = 1MB
    retry_max: 3                 # 最大重试次数 3
    batch_size: 100              # 批量大小 100
    batch_timeout: 10ms          # 批量超时 10ms
    write_timeout: 10s           # 写入超时 10s
    idempotent_enabled: true     # 启用幂等性

  # Consumer 配置
  consumer:
    read_timeout: 10s            # 读取超时 10s
    commit_interval: 1s          # 每秒提交一次
    start_offset: -1             # 从最新消息开始（kafka.LastOffset）
    min_bytes: 1                 # 最小 1 字节
    max_bytes: 10e6              # 最大 10MB
    max_wait: 500ms              # 最大等待 500ms

  # TLS 配置
  tls:
    # CA 证书文件路径（必需）
    ca_file: |
      -----BEGIN CERTIFICATE-----
      MIIDqTCCApGgAwIBAgIURgmgT+uaPMN9otpB7ZX7L5OOPt8wDQYJKoZIhvcNAQEL
      BQAwZDERMA8GA1UEAwwIa2Fma2EtY2ExDjAMBgNVBAsMBUthZmthMQ4wDAYDVQQK
      DAVLYWZrYTEQMA4GA1UEBwwHQmVpamluZzEQMA4GA1UECAwHQmVpamluZzELMAkG
      A1UEBhMCQ04wHhcNMjUxMjIyMDg1OTQxWhcNMzUxMjIwMDg1OTQxWjBkMREwDwYD
      VQQDDAhrYWZrYS1jYTEOMAwGA1UECwwFS2Fma2ExDjAMBgNVBAoMBUthZmthMRAw
      DgYDVQQHDAdCZWlqaW5nMRAwDgYDVQQIDAdCZWlqaW5nMQswCQYDVQQGEwJDTjCC
      ASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKRdnO0dDinasFK115zo1GkL
      ZY75a7HzWh7qMkrlnWkFmy/Ow2HSBmqzMUx1Mojexoi+UNo991KqlXZiHJZb3VeQ
      eLm13rAh6z8/garZ3ii3nIipQ66uvOdq5jrS77fy/BJPOBcSWSAjyCzOmS3LwvZV
      cdTYDwlqQt6s6e9Yox+ilwRsWojwA7MLbGibJOWR0O7Tz27b2xcYXNcFOXqKEoHb
      RYyfkySqwG2nclGSK0/H1KvTFvbqqBZSSxEkum2Nos5YAe5cZrguJxF7GkuC0vh5
      DmfoYGg2NeeyAswZnOs+564XifmPKwPDF2N2QCTGG8o5kij0f8L1+QZXwdR+eu8C
      AwEAAaNTMFEwHQYDVR0OBBYEFHJxO3fsdiyVKNftZo/W0VIbesEtMB8GA1UdIwQY
      MBaAFHJxO3fsdiyVKNftZo/W0VIbesEtMA8GA1UdEwEB/wQFMAMBAf8wDQYJKoZI
      hvcNAQELBQADggEBAGvYFJPqpVvtmxV9O+mhdl/az1hbKyDHBmC4M0/GnMxAb3mQ
      gQ8w7TKBk1O7ugzyHWS/igZswEDPm8lSYOixnrIQ0bdw1cQ04yeD/oTDdAcYSl3V
      7dL9poRx5ttIdrAM6wJw3Sm2J4EeI+evRjgR+lDdU+WDqakdm6Q0Lwp3PtNhx/a6
      5aObEkwZZU6HG0c5gDkHj9oPQVAPiDKHgXdVjSed+N5IiYAM/L5yq4ffYvN8EaEi
      4cVlpKQK14rSpr0bHF8h1rJN2/P1UxfE/BiCciE6VkUQPwQrjm8nGM9Z24FiRyPo
      q2lEqwnO7P2uLOb+JiSz8r42/GsToZKABqno8eg=
      -----END CERTIFICATE-----
  # SASL 配置
  # 支持两种认证机制：
  # 1. SCRAM-SHA-256 (默认)
  # 2. OAUTHBEARER
  sasl:
    # 认证机制类型 (可选，默认为 "scram")
    mechanism: "oauth"  # 或 "scram"

    # SCRAM 认证配置 (当 mechanism 为 "scram" 或未设置时使用)
    # username: "synp"
    # password: "synp-secret"
    # 提示：建议使用环境变量存储密码
    # password: "${KAFKA_PASSWORD}"

    # OAuth 认证配置 (当 mechanism 为 "oauth" 时使用)
    oauth:
      endpoint: "http://192.168.3.3:18080/realms/kafka/protocol/openid-connect/token"
      client_id: "kafka-client"
      client_secret: "b7rQYTc0y3eqDkGXFYD2UIPjYJeFCaAC"
      # 提示：建议使用环境变量存储敏感信息
      # client_secret: "${KAFKA_OAUTH_CLIENT_SECRET}"

jwt:
  access:
    expiration: 1h   # Access Token 过期时间
    issuer: "hermet-access"
    private: |
      -----BEGIN PRIVATE KEY-----
      MC4CAQAwBQYDK2VwBCIEINuchwbkYeYD/jnGLyPjRAufQGP+WUckh+PK6U4u7fk1
      -----END PRIVATE KEY-----
    public: |
      -----BEGIN PUBLIC KEY-----
      MCowBQYDK2VwAyEA818wiIDR2aqxvLKcyQL2qvVCYlSs2A/izQi/K109rlU=
      -----END PUBLIC KEY-----

  refresh:
    expiration: 168h  # Refresh Token 过期时间
    issuer: "hermet-refresh"
    private: |
      -----BEGIN PRIVATE KEY-----
      MC4CAQAwBQYDK2VwBCIEIKPTxPL86hZ9ogcHUcl8RFnEK5+31567wtfNNi2fwOMv
      -----END PRIVATE KEY-----
    public: |
      -----BEGIN PUBLIC KEY-----
      MCowBQYDK2VwAyEAuulBhGrO5+ic3KquuV0hfO1KrOIjYC3OVtjzle+MqQI=
      -----END PUBLIC KEY-----
